{% extends "layout.html" %}

{% block pageTitle %}
Find an assessor | Energy performance of buildings
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <a href="/address" class="govuk-back-link">Back</a>

    <h1 class="govuk-heading-xl">Find an energy assessor</h1>

    <div class="postcode-search-form" style="background-color:whitesmoke;padding:30px">
      <form action="/result" method="post" class="form" onsubmit="return redirect();">
          <fieldset class="govuk-fieldset">
            <div class="govuk-form-group">
              <label class="govuk-label" for="postcode">
                Enter a postcode
              </label>
            <span id="more-detail-hint" class="govuk-hint">
              For example SW1A 2AA
            </span>
            <input name="postcode" class="govuk-input" id="address-postcode" type="text" value="SW1A 2AA"/>
            </div>
            <button class="govuk-button" data-module="govuk-button">Find</button>
          </fieldset>
        </form>
    </div>

    <p>Contact an assessor listed below to book an energy assessment.</p>

    <details class="govuk-details" data-module="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">
          Who accredits assessors
        </span>
      </summary>
      <div class="govuk-details__text">
        Accreditation schemes check that all the assessors listed below are qualified to carry out energy assessments on residential properties,
        and to issue Energy Performance Certificates.
      </div>
    </details>

    <h2 class="govuk-heading-m">1 - 10 of 30 results near SW1A 2AA:</h2>
    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">



    {%

        set assessors = [
        {
        "name": "William Desai",
        "distance": 0.2,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "CIBSIE",
        "assessor_ID": "1234"
        },
        {
        "name": "Amanda Sellen",
        "distance": 0.6,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "Sterling",
        "assessor_ID": "1234"
        },
        {
        "name": "Juliet Tague",
        "distance": 0.6,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "ECMK",
        "assessor_ID": "1234"
        },
        {
        "name": "Wallace Romney",
        "distance": 0.6,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "ECMK",
        "assessor_ID": "1234"
        },
        {
        "name": "Mohammed Stewart",
        "distance": 0.9,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "CIBSIE",
        "assessor_ID": "1234"
        },
        {
        "name": "Sandeep Sing",
        "distance": 1,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "ECMK",
        "assessor_ID": "1234"
        },
        {
        "name": "Simon Doe",
        "distance": 2,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "CIBSIE",
        "assessor_ID": "1234"
        },
        {
        "name": "Harald Anderson",
        "distance": 2,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "Elmhurst Energy",
        "assessor_ID": "1234"
        },
        {
        "name": "Daniel Adams",
        "distance": 4,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "Elmhurst Energy",
        "assessor_ID": "1234"
        },
        {
        "name": "Abul Minster",
        "distance": 5,
        "phone": "0792 102 1368",
        "email_address": "epbassessor@epb.com",
        "website": "epbassessments.com",
        "accreditation_scheme": "ECMK",
        "assessor_ID": "1234"
        }
        ]

        %}

    <ul class="govuk-list">
      {% for assessor in assessors %}
      <li>
        <div>
          <h2 class="govuk-heading-m">{{assessor.name}}</h2>
          <div>
            <dl class="govuk-summary-list govuk-summary-list--no-border">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Distance</dt>
                <dd class="govuk-summary-list__value">
                  {% if assessor.distance<1 %}
                  Less than 1 mile away
                  {% else %}
                  {{assessor.distance}} miles away
                  {% endif %}
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Contact details</dt>
                <dd class="govuk-summary-list__value">
                  <p>
                    <a href="tel:{{assessor.phone}}">{{assessor.phone}}</a>
                  </p>
                  <p>
                    <a href="mailto:{{assessor.email}}">{{assessor.email_address}}</a>
                  </p>
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Accredited by</dt>
                <dd class="govuk-summary-list__value">{{assessor.accreditation_scheme}}</dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Assessor ID</dt>
                <dd class="govuk-summary-list__value">{{assessor.assessor_ID}}</dd>
              </div>
            </dl>
          </div>
        </div>
        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
      </li>
      {% endfor %}
    </ul>

    <nav class="nav-pagination" role="navigation" aria-label="Pagination">
      <ul class="nav-pagination__list">
        <li class="nav-pagination__item nav-pagination__item--next">
          <a href="javascript:searchedPostcodeRedirect('2');" class="nav-pagination__link" rel="next">
            <span class="nav-pagination__link-title">
              <svg class="nav-pagination__link-icon" xmlns="http://www.w3.org/2000/svg" height="13" width="17" viewBox="0 0 17 13">
                <path fill="currentColor" d="m10.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
              </svg>
              <span class="nav-pagination__link-text">
                Next
              </span>
            </span>
            <span class="nav-pagination__link-divider visually-hidden">:</span>
            <span class="nav-pagination__link-label">2 of 3</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
<script type="text/javascript">

  function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}

 document.getElementById("address-postcode").value = unescape(getQueryVariable('var'))

</script>
<script type="text/javascript">
  function searchedPostcodeRedirect(page) {
    var postcode = document.getElementById("address-postcode").value;
    location.href = "/result_page"+page+"?var="+postcode;
    return false;

  }
</script>
<script type="text/javascript">
  function redirect() {
    var postcode = document.getElementById("address-postcode").value;
    var regex = RegExp('[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}');

    if (regex.test(postcode) == false) {
      location.href = "/address_invalid_postcode?var="+postcode;
    } else {
      location.href = "/result?var="+postcode;
    }
    return false;
  }
</script>


{% endblock %}
